{
  "entities": {
    "Farmer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Farmer",
      "type": "object",
      "description": "Represents a farmer in the Agro Visionaries application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the farmer entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the farmer."
        },
        "phone": {
          "type": "string",
          "description": "The farmer's phone number, used for OTP login."
        },
        "region": {
          "type": "string",
          "description": "The geographical region the farmer belongs to."
        },
        "language": {
          "type": "string",
          "description": "The farmer's preferred language."
        },
        "deviceIds": {
          "type": "array",
          "description": "References to Devices. (Relationship: Farmer 1:N Device)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "phone",
        "region",
        "language",
        "deviceIds"
      ]
    },
    "Device": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Device",
      "type": "object",
      "description": "Represents a LoRaWAN device registered to a farmer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the device entity."
        },
        "farmerId": {
          "type": "string",
          "description": "Reference to Farmer. (Relationship: Farmer 1:N Device)"
        },
        "location": {
          "type": "string",
          "description": "Stringified JSON for the device's location (latitude and longitude)."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about the device."
        },
        "status": {
          "type": "string",
          "description": "The current status of the device (e.g., active, inactive)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the device was registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "farmerId",
        "location",
        "notes",
        "status",
        "createdAt"
      ]
    },
    "SensorData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorData",
      "type": "object",
      "description": "Represents sensor data collected from a device.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sensor data entry."
        },
        "deviceId": {
          "type": "string",
          "description": "Reference to Device. (Relationship: Device 1:N SensorData)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the sensor data was recorded.",
          "format": "date-time"
        },
        "waterLevel": {
          "type": "number",
          "description": "Water level reading from the sensor."
        },
        "moisture": {
          "type": "number",
          "description": "Moisture level reading from the sensor."
        },
        "temperature": {
          "type": "number",
          "description": "Temperature reading from the sensor."
        },
        "rain": {
          "type": "number",
          "description": "Rainfall reading from the sensor."
        },
        "solar": {
          "type": "number",
          "description": "Solar radiation reading from the sensor."
        }
      },
      "required": [
        "id",
        "deviceId",
        "timestamp",
        "waterLevel",
        "moisture",
        "temperature",
        "rain",
        "solar"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents an alert generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alert entity."
        },
        "farmerId": {
          "type": "string",
          "description": "Reference to Farmer. (Relationship: Farmer 1:N Alert)"
        },
        "deviceId": {
          "type": "string",
          "description": "Reference to Device. (Relationship: Device 1:N Alert)"
        },
        "type": {
          "type": "string",
          "description": "The type of alert (e.g., low water level, dry soil)."
        },
        "message": {
          "type": "string",
          "description": "The message associated with the alert."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the alert was generated.",
          "format": "date-time"
        },
        "read": {
          "type": "boolean",
          "description": "Indicates whether the alert has been read by the farmer."
        }
      },
      "required": [
        "id",
        "farmerId",
        "deviceId",
        "type",
        "message",
        "timestamp",
        "read"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents a government administrator user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the administrator entity."
        },
        "email": {
          "type": "string",
          "description": "The administrator's email address, used for login.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "FcmToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FcmToken",
      "type": "object",
      "description": "Represents a Firebase Cloud Messaging (FCM) token for a farmer.",
      "properties": {
        "token": {
          "type": "string",
          "description": "The FCM token string."
        },
        "farmerId": {
          "type": "string",
          "description": "Reference to Farmer. (Relationship: Farmer 1:N FcmToken)"
        }
      },
      "required": [
        "token",
        "farmerId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "phone"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/farmers/{farmerId}",
        "definition": {
          "entityName": "Farmer",
          "schema": {
            "$ref": "#/backend/entities/Farmer"
          },
          "description": "Stores farmer profiles, authenticated via phone number and OTP. Uses path-based ownership for private farmer data.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores government user profiles, authenticated via email/password. Uses path-based ownership.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for the admin user."
            }
          ]
        }
      },
      {
        "path": "/farmers/{farmerId}/fcmTokens/{token}",
        "definition": {
          "entityName": "FcmToken",
          "schema": {
            "$ref": "#/backend/entities/FcmToken"
          },
          "description": "Stores FCM tokens for each farmer. Includes denormalized 'farmerId' for authorization independence.",
          "params": [
            {
              "name": "farmerId",
              "description": "The unique identifier for the farmer."
            },
            {
              "name": "token",
              "description": "The FCM token string."
            }
          ]
        }
      },
      {
        "path": "/devices/{deviceId}",
        "definition": {
          "entityName": "Device",
          "schema": {
            "$ref": "#/backend/entities/Device"
          },
          "description": "Stores device information. Includes denormalized 'farmerId' for authorization independence.",
          "params": [
            {
              "name": "deviceId",
              "description": "The unique identifier for the device."
            }
          ]
        }
      },
      {
        "path": "/sensorData/{sensorDataId}",
        "definition": {
          "entityName": "SensorData",
          "schema": {
            "$ref": "#/backend/entities/SensorData"
          },
          "description": "Stores sensor data readings from devices. Includes denormalized 'deviceId' for querying.",
          "params": [
            {
              "name": "sensorDataId",
              "description": "The unique identifier for the sensor data entry."
            }
          ]
        }
      },
      {
        "path": "/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Stores alerts generated by the system. Includes denormalized 'farmerId' and 'deviceId' for authorization independence and filtering.",
          "params": [
            {
              "name": "alertId",
              "description": "The unique identifier for the alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. The core strategy revolves around denormalization (Strategy A) and structural segregation (Strategy B) to avoid hierarchical authorization dependencies and simplify security rules. Access modeling (Strategy C) utilizes path-based ownership for farmer data and membership maps where applicable.\n\nSpecifically, authorization independence is achieved by storing relevant authorization data (such as farmerId on devices and alerts) directly within the child documents. This eliminates the need for `get()` calls in security rules, enabling atomic operations. For instance, the `/devices` collection stores the `farmerId`, so rules can enforce that only the owning farmer can modify the device. Similarly, alerts also contain `farmerId` and `deviceId` so we can secure those collections as well.\n\nQAPs are supported through structural segregation.  Private farmer data resides under `/farmers/{farmerId}`, enabling secure list operations using path-based rules.  Government user data lives under `/admins/{adminId}`. Device and alerts are stored in top-level collections for easy querying while also containing `farmerId` for authorization purposes.\n\nDenormalization is also used in the `fcmTokens` subcollection, where the farmerId is included in each token document to ensure authorization independence. This allows us to easily verify token ownership when sending push notifications."
  }
}